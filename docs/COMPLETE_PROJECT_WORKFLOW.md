# COMPLETE_PROJECT_WORKFLOW嚗?蝡?HTML ??AnyContent JSON ??zh-cn ??WordPress嚗?
> ?祆?獢?餈啜擃?pipeline??蝝圈閬???嗡? docs?? 
> 撖虫????剝?嚗?> - `docs/CONTENT_SCHEMA.md`
> - `docs/HTML_TO_MARKDOWN_RULES_V4.md`
> - `docs/ZH_TW_TO_ZH_CN_PIPELINE.md`
> - `docs/WORKFLOW_CHATGPT_GITHUB_AGENT.md`

---

## 1. ?挾蝮質汗

1. ?祈??獢暺? 
2. HTML ????瘣? 
3. HTML ??Markdown嚗? + ????刻???  
4. Markdown + metadata ??AnyContent JSON  
5. zh-tw ??zh-cn pipeline  
6. ?臬 WordPress嚗 Polylang & redirect嚗? 
7. ?臬敺?霅?鈭箏極隤踵  

---

## 2. ?祈??獢暺?
**?格?嚗?*  
蝣箏???蝡??芯?????踹??镼踵?????啣?擗??暹???
**撌亙?撓?綽?**

- 撌亙嚗?  - `tools/crawl/crawl-ctworld.ts`
  - `tools/crawl/filesystem-inventory.ts`
  - `tools/crawl/diff-crawl-vs-files.ts`
- NPM scripts嚗歇??`package.json` 銝剖?蝢抬?嚗?  - `npm run crawl:ctworld`
  - `npm run inventory:fs`
  - `npm run diff:crawl-vs-fs`
- 銝餉?頛詨嚗?  - `data/crawl/crawled-urls.{json,csv}`
  - `data/crawl/all-files.{json,csv}`
  - `data/crawl/{missing-from-crawl,extra-from-crawl}.csv`

> 閰喟敦???芯??航???`docs/crawl-and-inventory.md`??
---

## 3. HTML ????瘣?
**?格?嚗?*  
撠?銝??legacy URL??敺?HTML嚗蒂??撠?瘣??嫣噶敺?閫????
**頛詨嚗?*

- 敺?crawl + inventory ?游?敺? URL ?”嚗歇?銝?閬?憭?嚗??桐葉??蝑???
**??嚗?*

- ??Node `fetch` ?? HTML??- 皜?＊銝?閬???嚗<script>` / `<style>` / 銝鈭蝡?header/footer?佗???- 靽???`LegacyHtmlDocument` 蝯?嚗?  - `url: string`
  - `html: string`
  - 銋??舀??憒?`fetched_at`, `http_status` 蝑?
**頛詨嚗?*

- 撱箄降雿輻 JSONL ????JSON 瑼?靘?敺?pipeline 雿輻嚗?  - 靘?嚗data/html-dump/legacy-html.jsonl`嚗?銵???`LegacyHtmlDocument`嚗?
---

## 4. HTML ??Markdown嚗htmlToMarkdown`嚗?
**?格?嚗?*  
??蝭?HTML ?蜓?批捆????Markdown嚗蒂?園????nchors??隤?蝯?鞈???
**撖虫?雿蔭嚗?*

- `src/html/html-to-markdown.ts`
- 閬嚗docs/HTML_TO_MARKDOWN_RULES_V4.md`

**頛詨嚗?*

- `LegacyHtmlDocument`嚗撠???`url` ??`html`嚗?
**頛詨嚗?*

- `HtmlToMarkdownResult`嚗?閬?嚗?  - `body_markdown: string`
  - `images: HtmlImageInfo[]`嚗??Ｗ?箇??????src / alt嚗?  - `anchors: string[]`嚗? `item83`嚗?  - `verses: string[]`嚗?隤?蝬?畾菔????嚗?
**瘜冽?嚗?*

- 甇日?畾?*銝捱摰?*嚗?  - featured image ?臬銝撘?  - caption 閬神隞暻?  - ??閬?閬???`meta`
- ??瘙箇??策?? post_type adapter??
---

## 5. Markdown + metadata ??AnyContent JSON

**?格?嚗?*  
瘥? HTML 頧???瑽? JSON??? post_type嚗eaching / news / magazine / ?佗?憛怠撠?甈???
**撖虫?雿蔭嚗?蝥?葉嚗?**

- ?嚗?  - `src/types/anycontent-teaching.ts`嚗歇摰?嚗?  - ?芯?嚗src/types/anycontent-news.ts`, `src/types/anycontent-magazine.ts`, ??- adapter嚗?  - `src/adapters/teaching-from-legacy.ts`嚗歇摰? v1嚗?  - ?芯?嚗src/adapters/news-from-legacy.ts`, `src/adapters/magazine-from-legacy.ts`, ??
**頛詨嚗?*

- `LegacyHtmlDocument`嚗 URL + HTML嚗?- `HtmlToMarkdownResult`嚗 `htmlToMarkdown` 頧嚗?- 憭惜蝯衣?嚗?  - `externalId: string`
  - `language: "zh-tw" | "zh-cn" | "en" | "ja"`

**頛詨嚗?*

- ??post_type ??`*Content`嚗?憒?`TeachingContent`嚗?蝯?撠? `docs/CONTENT_SCHEMA.md`??
---

## 6. zh-tw ??zh-cn pipeline

**?格?嚗?*  
?其??? `-gb` HTML ????嚗瘥??批捆?Ｙ?撠???`zh-cn` ?嚗蒂靽??陛擃雯?嚗-gb`嚗? redirect 雿輻??
**閬靘?嚗?*

- `docs/ZH_TW_TO_ZH_CN_PIPELINE.md`

**擃惜瘚?嚗?*

1. 撱箇? `baseUrl ??gbUrl` 撠?嚗? sitemap / ?Ｘ? URL ??嚗?2. ?芸? `baseUrl`嚗?銝哨???HTML ???Ｙ? zh-tw AnyContent JSON??3. 雿輻 OpenCC嚗?蝑?撌亙嚗?甇?zh-tw JSON嚗??zh-cn JSON嚗?   - 閬??芯?甈?閬??鈭??賢?嚗RL, ID, enum?佗???4. ?臬 WordPress ??
   - 蝚砌?頛芸??zh-tw??   - 蝚砌?頛芸??zh-cn嚗蒂?? external_id / group key 撱箇? Polylang 撠???   - 撠?`old_url` / `-gb` URL 摮?meta嚗? redirect 雿輻??
---

## 7. ?臬 WordPress 嚗?Polylang 嚗?redirect

**?格?嚗?*  
??AnyContent JSON嚗h-tw + zh-cn嚗??典??Headless WordPress嚗蒂撱箇?憭?嚗?蝬脣? redirect??
**??閮剛?嚗?*

- WordPress 蝡臬祕雿?
  - WP-CLI ?誘??plugin嚗?    - 霈 JSON 瑼?敺???? API嚗?    - 靘?post_type 撱箇?嚗?唳?蝡?    - 閮剖?嚗?      - `language`嚗olylang嚗?      - `ct_external_id`嚗eta嚗?      - ??`ct_*` meta 甈?嚗peaker, location, event_date?佗?
    - 撖怠?雯?嚗?      - `_ct_old_url`嚗?蝜葉 URL嚗?      - `_ct_old_url_gb`嚗? `-gb` URL嚗???嚗?- Redirect嚗?  - ?臭蝙?函??redirect 憭?嚗??芸神銝?陛??routing嚗?    - ???URL嚗 meta ??301 ?唳蝡??楝敺?
---

## 8. ?臬敺?霅?鈭箏極隤踵

**?格?嚗?*  
蝣箔?????鞈??????銝行?靘?暺犖撌亙凝隤輻征??
**憭扯雿?嚗?*

1. 撠嚗?   - `data/crawl/crawled-urls.csv`
   - ?臬????WordPress post ?”
   - ??行? URL ??撠??唬遙雿?蝡?2. Spot check嚗?   - ?冽??嗾??sutra / blossom / news嚗Ⅱ隤?
     - Markdown ???臬蝚血?????     - ????箸??隤扎?3. ?交??寞??桀??閬恥鋆?layout嚗?憒??椰?渡???喳??嚗?
   - ?勗?蝡?React ?寞? `post_type` + `meta` 皜脫?嚗??閬???pipeline??
